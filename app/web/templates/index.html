{% extends "base.html" %} {% block content %}
<h1>Reportes recientes</h1>
<p><a class="btn" href="/web/upload">+ Nuevo lote</a></p>

<table class="table">
  <thead>
    <tr>
      <th>Lote</th>
      <th>SKU</th>
      <th>Imágenes</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
    <tr>
      <td>{{ it.lote }}</td>
      <td>{{ it.sku }}</td>
      <td>{{ it.num }}</td>
      <td>
        <a class="btn" href="/web/batch/{{ it.lote }}">Ver</a>
        <a class="btn" href="{{ it.pdf }}" target="_blank">Descargar PDF</a>
        <button class="btn btn-danger" onclick="deleteLote('{{ it.lote }}')">Borrar</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
  </table>

  <div style="display:flex; gap:8px; align-items:center;">
    {% if page > 1 %}
      <a class="btn" href="/web/?page={{ page - 1 }}&per_page={{ per_page }}">« Anterior</a>
    {% endif %}
    <span>Página {{ page }} de {{ total_pages }}</span>
    {% if page < total_pages %}
      <a class="btn" href="/web/?page={{ page + 1 }}&per_page={{ per_page }}">Siguiente »</a>
    {% endif %}
  </div>

<script>
async function deleteLote(lote){
  if(!confirm('¿Borrar lote ' + lote + ' y sus archivos?')) return;
  try{
    const res = await fetch('/web/delete/' + lote, {method:'POST'});
    const data = await res.json();
    if(data.ok){
      location.reload();
    }else{
      alert('Error al borrar: ' + (data.error || 'desconocido'));
    }
  }catch(e){
    alert('Error de red al borrar');
  }
}
</script>
{% endblock %}
